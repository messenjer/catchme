define(["require","zepto","underscore","backbone","./anim","./view"],function(e){var t=e("zepto"),n=e("underscore"),r=e("backbone"),i=e("./anim"),s=e("./view"),o=r.Model.extend({}),u=r.Collection.extend({model:o}),a=s.extend({initialize:function(){this.initView(),this.collection.bind("add",n.bind(this.appendItem,this)),this.collection.bind("reset",n.bind(this.render,this));var e=this.el;i.onAnimationEnd(e,function(){console.log("unhighlighting"),t("ul._list > li",e).removeClass("highlighted")}),t(".contents",this.el).append('<ul class="_list"></ul>'),this.render()},render:function(){t("._list",this.el).html(""),n.each(this.collection.models,function(e){this.appendItem(e)},this)},appendItem:function(e){var n=new f({model:e,titleField:this.options.titleField,render:this.options.renderRow,nextView:this.options.nextView,parent:this});t("._list",this.el).append(n.render().el)}}),f=r.View.extend({tagName:"li",events:function(){return"ontouchstart"in document.documentElement?{touchstart:"touchMouseStart",touchmove:"touchMove",touchend:"touchMouseEnd"}:{mousedown:"touchMouseStart",mouseleave:"mouseLeave",mouseup:"touchMouseEnd"}},initialize:function(){this.model.on("change",n.bind(this.render,this))},touchMouseStart:function(e){var n=e.changedTouches?e.changedTouches[0]:e;this.touchPos=[n.pageX,n.pageY];var r=this;this.highlightTimer=setTimeout(function(){t(r.el).addClass("highlighted"),r.highlightTimer=null},120)},mouseLeave:function(e){t(this.el).removeClass("highlighted"),this.touchPos=null},touchMove:function(e){var n=e.changedTouches?e.changedTouches[0]:e,r=this.touchPos[0]-n.pageX,i=this.touchPos[1]-n.pageY;if(r>=10||r<=-10||i>=10||i<=-10)this.highlightTimer&&clearTimeout(this.highlightTimer),t(this.el).removeClass("highlighted"),this.touchPos=null},touchMouseEnd:function(e){this.touchPos&&(t(this.el).addClass("highlighted"),this.open())},render:function(){var e=this.model,t=this.options.titleField||"title";return this.options.render?this.options.render.call(this.el,e):e.get(t)?this.el.innerHTML=e.get(t):console.log('[ListViewRow] WARNING: item does not have a "title" field, the titleField property is not set, and no custom render function is set'),this},open:function(){var e=this.options,n=e.nextView||"x-view.detail",r=t(n).get(0);r&&r.open(this.model)}});return a.defaultListType=u,a})